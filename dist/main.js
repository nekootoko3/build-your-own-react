/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function createElement(type, props) {
  for (var _len = arguments.length, children = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
    children[_key - 2] = arguments[_key];
  }

  return {
    type: type,
    props: _objectSpread(_objectSpread({}, props), {}, {
      children: children.map(function (child) {
        return _typeof(child) === "object" ? child : createTextElement(child);
      })
    })
  };
}

function createTextElement(text) {
  return {
    type: "TEXT_ELEMENT",
    props: {
      nodeValue: text,
      children: []
    }
  };
}

var nextUnitOfWork = null;
var currentRoot = null;
var wipRoot = null;
var deletions = null;

function commitRoot() {
  // dom に node を追加する
  commitWork(wipRoot.child); // dom にコミットした最後のファイバーツリーを currentRoot として参照を保存する

  currentRoot = wipRoot; // ファイバーツリーの root を null にする

  wipRoot = null;
}

function render(element, container) {
  wipRoot = {
    dom: container,
    props: {
      children: [element]
    },
    alternate: currentRoot
  };
  deletions = [];
  nextUnitOfWork = wipRoot;
}

function commitWork(fiber) {
  if (!fiber) {
    return;
  } // 関数コンポーネントから作られるファイバーには dom ノードがないので DOMノードを持つファイバーが見つかるまでファイバーツリーを上に移動


  var domParentFiber = fiber.parent;

  while (!domParentFiber.dom) {
    domParentFiber = domParentFiber.parent;
  }

  var domParent = domParentFiber.dom; // fiber の effectTag に応じて fiber.dom を dom に反映する

  if (fiber.effectTag === "PLACEMENT" && fiber.dom != null) {
    domParent.appendChild(fiber.dom);
  } else if (fiber.effectTag === "UPDATE" && fiber.dom != null) {
    updateDom(fiber.dom, fiber.alternate.props, fiber.props);
  } else if (fiber.effectTag === "DELETION") {
    commitDeletion(fiber, domParent); // ノードを削除するときは、DOMノードを持つ子が見つかるまで探索を続行
  } // child と sibling も再帰的に処理


  commitWork(fiber.child);
  commitWork(fiber.sibling);
}

var isNew = function isNew(prev, next) {
  return function (key) {
    return prev[key] !== next[key];
  };
};

var isGone = function isGone(prev, next) {
  return function (key) {
    return !(key in next);
  };
};

var isEvent = function isEvent(key) {
  return key.startsWith("on");
};

var isProperty = function isProperty(key) {
  return key !== "children" && !isEvent(key);
};

function updateDom(dom, prevProps, nextProps) {
  // 古い properties を削除
  Object.keys(prevProps).filter(isProperty).filter(isGone(prevProps, nextProps)).forEach(function (name) {
    dom[name] = "";
  }); // 新規 or 変更された property を反映

  Object.keys(nextProps).filter(isProperty).filter(isNew(prevProps, nextProps)).forEach(function (name) {
    dom[name] = nextProps[name];
  }); // 古い、または変更されたイベントリスナーを削除

  Object.keys(prevProps).filter(isEvent).filter(function (key) {
    return !(key in nextProps) || isNew(prevProps, nextProps)(key);
  }).forEach(function (name) {
    var eventType = name.toLowerCase().substring(2);
    dom.removeEventListener(eventType, prevProps[name]);
  }); // イベントリスナーを追加

  Object.keys(nextProps).filter(isEvent).filter(isNew(prevProps, nextProps)).forEach(function (name) {
    var eventType = name.toLowerCase().substring(2);
    dom.addEventListener(eventType, nextProps[name]);
  });
}

function commitDeletion(fiber, domParent) {
  if (fiber.dom) {
    domParent.removeChild(fiber.dom);
  } else {
    commitDeletion(fiber.child, domParent);
  }
}

function workLoop(deadline) {
  // rendering phase
  var shouldYield = false;

  while (nextUnitOfWork && !shouldYield) {
    nextUnitOfWork = performUnitOfWork(nextUnitOfWork);
    shouldYield = deadline.timeRemaining() < 1;
  } // commit phase


  if (!nextUnitOfWork && wipRoot) {
    commitRoot();
  }

  requestIdleCallback(workLoop);
} // メインスレッドがアイドル状態のときにブラウザがコールバックを実行


requestIdleCallback(workLoop);

function performUnitOfWork(fiber) {
  var isFunctionComponent = fiber.type instanceof Function;

  if (isFunctionComponent) {
    updateFunctionComponent(fiber);
  } else {
    updateHostComponent(fiber);
  } // 子要素ごとに新しいファイバーを作成


  var elements = fiber.props.children;
  reconcileChildren(fiber, elements); // 作業単位を検索。 最初に子要素、次に兄弟、次におじというように試みる

  if (fiber.child) {
    return fiber.child;
  }

  var nextFiber = fiber;

  while (nextFiber) {
    if (nextFiber.sibling) {
      return nextFiber.sibling;
    }

    nextFiber = nextFiber.parent;
  }
}

function updateFunctionComponent(fiber) {
  var children = [fiber.type(fiber.props)];
  reconcileChildren(fiber, children);
}

function updateHostComponent(fiber) {
  // もし追加されていなければ、自身の dom を fiber から作成し親ノードに追加
  if (!fiber.dom) {
    fiber.dom = createDom(fiber);
  }

  reconcileChildren(fiber, fiber.props.children);
} // wipFiber の子とその兄弟について、古いファイバーと新しいファイバーを比較し wipFiber を更新する


function reconcileChildren(wipFiber, elements) {
  var index = 0;
  var oldFiber = wipFiber.alternate && wipFiber.alternate.child;
  var prevSibling = null; // 配列( elements )とリンクリスト ( oldFiber は sibling を通したリンクリストになっている )を同時にループ処理する

  while (index < elements.length || oldFiber != null) {
    var _element = elements[index];
    var newFiber = null;
    var sameType = oldFiber && _element && _element.type === oldFiber.type; // 古いファイバーとelementが同じタイプの場合、dom を古いファイバーから保持し、props は element から保持するように、新しいファイバーを作成

    if (sameType) {
      newFiber = {
        type: oldFiber.type,
        props: _element.props,
        dom: oldFiber.dom,
        parent: wipFiber,
        alternate: oldFiber,
        effectTag: "UPDATE"
      };
    } // 要素に新しいDOMノードが必要な場合は、新しいファイバーにPLACEMENTをタグ付け


    if (_element && !sameType) {
      newFiber = {
        type: _element.type,
        props: _element.props,
        dom: null,
        parent: wipFiber,
        alternate: null,
        effectTag: "PLACEMENT"
      };
    } // ノードを削除する必要がある場合は、新しいファイバーがないため、古いファイバーにエフェクトタグを追加


    if (oldFiber && !sameType) {
      oldFiber.effectTag = "DELETION";
      deletions.push(oldFiber);
    }

    if (oldFiber) {
      oldFiber = oldFiber.sibling;
    }

    if (index === 0) {
      wipFiber.child = newFiber;
    } else {
      prevSibling.sibling = newFiber;
    }

    prevSibling = newFiber;
    index++;
  }
}

function createDom(fiber) {
  // element type に応じてノードを作成
  var dom = fiber.type === "TEXT_ELEMENT" ? document.createTextNode("") : document.createElement(fiber.type); // children を除く property の割り当て

  var isProperty = function isProperty(key) {
    return key !== "children";
  };

  Object.keys(fiber.props).filter(isProperty).forEach(function (name) {
    dom[name] = fiber.props[name];
  });
  return dom;
}

var Didact = {
  createElement: createElement,
  render: render
};
/** @jsx Didact.createElement */

function App(props) {
  return Didact.createElement("h1", null, "Hi ", props.name);
}

var element = Didact.createElement(App, {
  name: "foo"
});
var container = document.getElementById("root");
Didact.render(element, container);
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDbEIsU0FBTyx3Q0FBUUEsS0FBSyxDQUFDeUMsSUFBZCxDQUFQO0FBQ0Q7O0FBRUQsSUFBTTNCLE9BQU8sR0FBRyxxQkFBQyxHQUFEO0FBQUssTUFBSSxFQUFDO0FBQVYsRUFBaEI7QUFDQSxJQUFNQyxTQUFTLEdBQUd1RCxRQUFRLENBQUNJLGNBQVQsQ0FBd0IsTUFBeEIsQ0FBbEI7QUFDQUYsTUFBTSxDQUFDM0QsTUFBUCxDQUFjQyxPQUFkLEVBQXVCQyxTQUF2QixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnVpbGQteW91ci1vd24tcmVhY3QvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0eXBlLCBwcm9wcywgLi4uY2hpbGRyZW4pIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlLFxuICAgIHByb3BzOiB7XG4gICAgICAuLi5wcm9wcyxcbiAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbi5tYXAoKGNoaWxkKSA9PlxuICAgICAgICB0eXBlb2YgY2hpbGQgPT09IFwib2JqZWN0XCIgPyBjaGlsZCA6IGNyZWF0ZVRleHRFbGVtZW50KGNoaWxkKVxuICAgICAgKSxcbiAgICB9LFxuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUZXh0RWxlbWVudCh0ZXh0KSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJURVhUX0VMRU1FTlRcIixcbiAgICBwcm9wczoge1xuICAgICAgbm9kZVZhbHVlOiB0ZXh0LFxuICAgICAgY2hpbGRyZW46IFtdLFxuICAgIH0sXG4gIH07XG59XG5cbmxldCBuZXh0VW5pdE9mV29yayA9IG51bGw7XG5sZXQgY3VycmVudFJvb3QgPSBudWxsO1xubGV0IHdpcFJvb3QgPSBudWxsO1xubGV0IGRlbGV0aW9ucyA9IG51bGw7XG5cbmZ1bmN0aW9uIGNvbW1pdFJvb3QoKSB7XG4gIC8vIGRvbSDjgasgbm9kZSDjgpLov73liqDjgZnjgotcbiAgY29tbWl0V29yayh3aXBSb290LmNoaWxkKTtcbiAgLy8gZG9tIOOBq+OCs+ODn+ODg+ODiOOBl+OBn+acgOW+jOOBruODleOCoeOCpOODkOODvOODhOODquODvOOCkiBjdXJyZW50Um9vdCDjgajjgZfjgablj4LnhafjgpLkv53lrZjjgZnjgotcbiAgY3VycmVudFJvb3QgPSB3aXBSb290O1xuICAvLyDjg5XjgqHjgqTjg5Djg7zjg4Tjg6rjg7zjga4gcm9vdCDjgpIgbnVsbCDjgavjgZnjgotcbiAgd2lwUm9vdCA9IG51bGw7XG59XG5cbmZ1bmN0aW9uIHJlbmRlcihlbGVtZW50LCBjb250YWluZXIpIHtcbiAgd2lwUm9vdCA9IHtcbiAgICBkb206IGNvbnRhaW5lcixcbiAgICBwcm9wczoge1xuICAgICAgY2hpbGRyZW46IFtlbGVtZW50XSxcbiAgICB9LFxuICAgIGFsdGVybmF0ZTogY3VycmVudFJvb3QsXG4gIH07XG4gIGRlbGV0aW9ucyA9IFtdO1xuICBuZXh0VW5pdE9mV29yayA9IHdpcFJvb3Q7XG59XG5cbmZ1bmN0aW9uIGNvbW1pdFdvcmsoZmliZXIpIHtcbiAgaWYgKCFmaWJlcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIOmWouaVsOOCs+ODs+ODneODvOODjeODs+ODiOOBi+OCieS9nOOCieOCjOOCi+ODleOCoeOCpOODkOODvOOBq+OBryBkb20g44OO44O844OJ44GM44Gq44GE44Gu44GnIERPTeODjuODvOODieOCkuaMgeOBpOODleOCoeOCpOODkOODvOOBjOimi+OBpOOBi+OCi+OBvuOBp+ODleOCoeOCpOODkOODvOODhOODquODvOOCkuS4iuOBq+enu+WLlVxuICBsZXQgZG9tUGFyZW50RmliZXIgPSBmaWJlci5wYXJlbnQ7XG4gIHdoaWxlICghZG9tUGFyZW50RmliZXIuZG9tKSB7XG4gICAgZG9tUGFyZW50RmliZXIgPSBkb21QYXJlbnRGaWJlci5wYXJlbnQ7XG4gIH1cbiAgY29uc3QgZG9tUGFyZW50ID0gZG9tUGFyZW50RmliZXIuZG9tO1xuXG4gIC8vIGZpYmVyIOOBriBlZmZlY3RUYWcg44Gr5b+c44GY44GmIGZpYmVyLmRvbSDjgpIgZG9tIOOBq+WPjeaYoOOBmeOCi1xuICBpZiAoZmliZXIuZWZmZWN0VGFnID09PSBcIlBMQUNFTUVOVFwiICYmIGZpYmVyLmRvbSAhPSBudWxsKSB7XG4gICAgZG9tUGFyZW50LmFwcGVuZENoaWxkKGZpYmVyLmRvbSk7XG4gIH0gZWxzZSBpZiAoZmliZXIuZWZmZWN0VGFnID09PSBcIlVQREFURVwiICYmIGZpYmVyLmRvbSAhPSBudWxsKSB7XG4gICAgdXBkYXRlRG9tKGZpYmVyLmRvbSwgZmliZXIuYWx0ZXJuYXRlLnByb3BzLCBmaWJlci5wcm9wcyk7XG4gIH0gZWxzZSBpZiAoZmliZXIuZWZmZWN0VGFnID09PSBcIkRFTEVUSU9OXCIpIHtcbiAgICBjb21taXREZWxldGlvbihmaWJlciwgZG9tUGFyZW50KTsgLy8g44OO44O844OJ44KS5YmK6Zmk44GZ44KL44Go44GN44Gv44CBRE9N44OO44O844OJ44KS5oyB44Gk5a2Q44GM6KaL44Gk44GL44KL44G+44Gn5o6i57Si44KS57aa6KGMXG4gIH1cblxuICAvLyBjaGlsZCDjgaggc2libGluZyDjgoLlho3luLDnmoTjgavlh6bnkIZcbiAgY29tbWl0V29yayhmaWJlci5jaGlsZCk7XG4gIGNvbW1pdFdvcmsoZmliZXIuc2libGluZyk7XG59XG5cbmNvbnN0IGlzTmV3ID0gKHByZXYsIG5leHQpID0+IChrZXkpID0+IHByZXZba2V5XSAhPT0gbmV4dFtrZXldO1xuY29uc3QgaXNHb25lID0gKHByZXYsIG5leHQpID0+IChrZXkpID0+ICEoa2V5IGluIG5leHQpO1xuY29uc3QgaXNFdmVudCA9IChrZXkpID0+IGtleS5zdGFydHNXaXRoKFwib25cIik7XG5jb25zdCBpc1Byb3BlcnR5ID0gKGtleSkgPT4ga2V5ICE9PSBcImNoaWxkcmVuXCIgJiYgIWlzRXZlbnQoa2V5KTtcbmZ1bmN0aW9uIHVwZGF0ZURvbShkb20sIHByZXZQcm9wcywgbmV4dFByb3BzKSB7XG4gIC8vIOWPpOOBhCBwcm9wZXJ0aWVzIOOCkuWJiumZpFxuICBPYmplY3Qua2V5cyhwcmV2UHJvcHMpXG4gICAgLmZpbHRlcihpc1Byb3BlcnR5KVxuICAgIC5maWx0ZXIoaXNHb25lKHByZXZQcm9wcywgbmV4dFByb3BzKSlcbiAgICAuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgICAgZG9tW25hbWVdID0gXCJcIjtcbiAgICB9KTtcblxuICAvLyDmlrDopo8gb3Ig5aSJ5pu044GV44KM44GfIHByb3BlcnR5IOOCkuWPjeaYoFxuICBPYmplY3Qua2V5cyhuZXh0UHJvcHMpXG4gICAgLmZpbHRlcihpc1Byb3BlcnR5KVxuICAgIC5maWx0ZXIoaXNOZXcocHJldlByb3BzLCBuZXh0UHJvcHMpKVxuICAgIC5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgICBkb21bbmFtZV0gPSBuZXh0UHJvcHNbbmFtZV07XG4gICAgfSk7XG5cbiAgLy8g5Y+k44GE44CB44G+44Gf44Gv5aSJ5pu044GV44KM44Gf44Kk44OZ44Oz44OI44Oq44K544OK44O844KS5YmK6ZmkXG4gIE9iamVjdC5rZXlzKHByZXZQcm9wcylcbiAgICAuZmlsdGVyKGlzRXZlbnQpXG4gICAgLmZpbHRlcigoa2V5KSA9PiAhKGtleSBpbiBuZXh0UHJvcHMpIHx8IGlzTmV3KHByZXZQcm9wcywgbmV4dFByb3BzKShrZXkpKVxuICAgIC5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgICBjb25zdCBldmVudFR5cGUgPSBuYW1lLnRvTG93ZXJDYXNlKCkuc3Vic3RyaW5nKDIpO1xuICAgICAgZG9tLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBwcmV2UHJvcHNbbmFtZV0pO1xuICAgIH0pO1xuICAvLyDjgqTjg5njg7Pjg4jjg6rjgrnjg4rjg7zjgpLov73liqBcbiAgT2JqZWN0LmtleXMobmV4dFByb3BzKVxuICAgIC5maWx0ZXIoaXNFdmVudClcbiAgICAuZmlsdGVyKGlzTmV3KHByZXZQcm9wcywgbmV4dFByb3BzKSlcbiAgICAuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRUeXBlID0gbmFtZS50b0xvd2VyQ2FzZSgpLnN1YnN0cmluZygyKTtcbiAgICAgIGRvbS5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgbmV4dFByb3BzW25hbWVdKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gY29tbWl0RGVsZXRpb24oZmliZXIsIGRvbVBhcmVudCkge1xuICBpZiAoZmliZXIuZG9tKSB7XG4gICAgZG9tUGFyZW50LnJlbW92ZUNoaWxkKGZpYmVyLmRvbSk7XG4gIH0gZWxzZSB7XG4gICAgY29tbWl0RGVsZXRpb24oZmliZXIuY2hpbGQsIGRvbVBhcmVudCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gd29ya0xvb3AoZGVhZGxpbmUpIHtcbiAgLy8gcmVuZGVyaW5nIHBoYXNlXG4gIGxldCBzaG91bGRZaWVsZCA9IGZhbHNlO1xuICB3aGlsZSAobmV4dFVuaXRPZldvcmsgJiYgIXNob3VsZFlpZWxkKSB7XG4gICAgbmV4dFVuaXRPZldvcmsgPSBwZXJmb3JtVW5pdE9mV29yayhuZXh0VW5pdE9mV29yayk7XG4gICAgc2hvdWxkWWllbGQgPSBkZWFkbGluZS50aW1lUmVtYWluaW5nKCkgPCAxO1xuICB9XG5cbiAgLy8gY29tbWl0IHBoYXNlXG4gIGlmICghbmV4dFVuaXRPZldvcmsgJiYgd2lwUm9vdCkge1xuICAgIGNvbW1pdFJvb3QoKTtcbiAgfVxuXG4gIHJlcXVlc3RJZGxlQ2FsbGJhY2sod29ya0xvb3ApO1xufVxuXG4vLyDjg6HjgqTjg7Pjgrnjg6zjg4Pjg4njgYzjgqLjgqTjg4njg6vnirbmhYvjga7jgajjgY3jgavjg5bjg6njgqbjgrbjgYzjgrPjg7zjg6vjg5Djg4Pjgq/jgpLlrp/ooYxcbnJlcXVlc3RJZGxlQ2FsbGJhY2sod29ya0xvb3ApO1xuXG5mdW5jdGlvbiBwZXJmb3JtVW5pdE9mV29yayhmaWJlcikge1xuICBjb25zdCBpc0Z1bmN0aW9uQ29tcG9uZW50ID0gZmliZXIudHlwZSBpbnN0YW5jZW9mIEZ1bmN0aW9uO1xuICBpZiAoaXNGdW5jdGlvbkNvbXBvbmVudCkge1xuICAgIHVwZGF0ZUZ1bmN0aW9uQ29tcG9uZW50KGZpYmVyKTtcbiAgfSBlbHNlIHtcbiAgICB1cGRhdGVIb3N0Q29tcG9uZW50KGZpYmVyKTtcbiAgfVxuXG4gIC8vIOWtkOimgee0oOOBlOOBqOOBq+aWsOOBl+OBhOODleOCoeOCpOODkOODvOOCkuS9nOaIkFxuICBjb25zdCBlbGVtZW50cyA9IGZpYmVyLnByb3BzLmNoaWxkcmVuO1xuICByZWNvbmNpbGVDaGlsZHJlbihmaWJlciwgZWxlbWVudHMpO1xuXG4gIC8vIOS9nOalreWNmOS9jeOCkuaknOe0ouOAgiDmnIDliJ3jgavlrZDopoHntKDjgIHmrKHjgavlhYTlvJ/jgIHmrKHjgavjgYrjgZjjgajjgYTjgYbjgojjgYbjgavoqabjgb/jgotcbiAgaWYgKGZpYmVyLmNoaWxkKSB7XG4gICAgcmV0dXJuIGZpYmVyLmNoaWxkO1xuICB9XG4gIGxldCBuZXh0RmliZXIgPSBmaWJlcjtcbiAgd2hpbGUgKG5leHRGaWJlcikge1xuICAgIGlmIChuZXh0RmliZXIuc2libGluZykge1xuICAgICAgcmV0dXJuIG5leHRGaWJlci5zaWJsaW5nO1xuICAgIH1cbiAgICBuZXh0RmliZXIgPSBuZXh0RmliZXIucGFyZW50O1xuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUZ1bmN0aW9uQ29tcG9uZW50KGZpYmVyKSB7XG4gIGNvbnN0IGNoaWxkcmVuID0gW2ZpYmVyLnR5cGUoZmliZXIucHJvcHMpXTtcbiAgcmVjb25jaWxlQ2hpbGRyZW4oZmliZXIsIGNoaWxkcmVuKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlSG9zdENvbXBvbmVudChmaWJlcikge1xuICAvLyDjgoLjgZfov73liqDjgZXjgozjgabjgYTjgarjgZHjgozjgbDjgIHoh6rouqvjga4gZG9tIOOCkiBmaWJlciDjgYvjgonkvZzmiJDjgZfopqrjg47jg7zjg4njgavov73liqBcbiAgaWYgKCFmaWJlci5kb20pIHtcbiAgICBmaWJlci5kb20gPSBjcmVhdGVEb20oZmliZXIpO1xuICB9XG4gIHJlY29uY2lsZUNoaWxkcmVuKGZpYmVyLCBmaWJlci5wcm9wcy5jaGlsZHJlbik7XG59XG5cbi8vIHdpcEZpYmVyIOOBruWtkOOBqOOBneOBruWFhOW8n+OBq+OBpOOBhOOBpuOAgeWPpOOBhOODleOCoeOCpOODkOODvOOBqOaWsOOBl+OBhOODleOCoeOCpOODkOODvOOCkuavlOi8g+OBlyB3aXBGaWJlciDjgpLmm7TmlrDjgZnjgotcbmZ1bmN0aW9uIHJlY29uY2lsZUNoaWxkcmVuKHdpcEZpYmVyLCBlbGVtZW50cykge1xuICBsZXQgaW5kZXggPSAwO1xuICBsZXQgb2xkRmliZXIgPSB3aXBGaWJlci5hbHRlcm5hdGUgJiYgd2lwRmliZXIuYWx0ZXJuYXRlLmNoaWxkO1xuICBsZXQgcHJldlNpYmxpbmcgPSBudWxsO1xuXG4gIC8vIOmFjeWIlyggZWxlbWVudHMgKeOBqOODquODs+OCr+ODquOCueODiCAoIG9sZEZpYmVyIOOBryBzaWJsaW5nIOOCkumAmuOBl+OBn+ODquODs+OCr+ODquOCueODiOOBq+OBquOBo+OBpuOBhOOCiyAp44KS5ZCM5pmC44Gr44Or44O844OX5Yem55CG44GZ44KLXG4gIHdoaWxlIChpbmRleCA8IGVsZW1lbnRzLmxlbmd0aCB8fCBvbGRGaWJlciAhPSBudWxsKSB7XG4gICAgY29uc3QgZWxlbWVudCA9IGVsZW1lbnRzW2luZGV4XTtcbiAgICBsZXQgbmV3RmliZXIgPSBudWxsO1xuXG4gICAgY29uc3Qgc2FtZVR5cGUgPSBvbGRGaWJlciAmJiBlbGVtZW50ICYmIGVsZW1lbnQudHlwZSA9PT0gb2xkRmliZXIudHlwZTtcblxuICAgIC8vIOWPpOOBhOODleOCoeOCpOODkOODvOOBqGVsZW1lbnTjgYzlkIzjgZjjgr/jgqTjg5fjga7loLTlkIjjgIFkb20g44KS5Y+k44GE44OV44Kh44Kk44OQ44O844GL44KJ5L+d5oyB44GX44CBcHJvcHMg44GvIGVsZW1lbnQg44GL44KJ5L+d5oyB44GZ44KL44KI44GG44Gr44CB5paw44GX44GE44OV44Kh44Kk44OQ44O844KS5L2c5oiQXG4gICAgaWYgKHNhbWVUeXBlKSB7XG4gICAgICBuZXdGaWJlciA9IHtcbiAgICAgICAgdHlwZTogb2xkRmliZXIudHlwZSxcbiAgICAgICAgcHJvcHM6IGVsZW1lbnQucHJvcHMsXG4gICAgICAgIGRvbTogb2xkRmliZXIuZG9tLFxuICAgICAgICBwYXJlbnQ6IHdpcEZpYmVyLFxuICAgICAgICBhbHRlcm5hdGU6IG9sZEZpYmVyLFxuICAgICAgICBlZmZlY3RUYWc6IFwiVVBEQVRFXCIsXG4gICAgICB9O1xuICAgIH1cbiAgICAvLyDopoHntKDjgavmlrDjgZfjgYRET03jg47jg7zjg4njgYzlv4XopoHjgarloLTlkIjjga/jgIHmlrDjgZfjgYTjg5XjgqHjgqTjg5Djg7zjgatQTEFDRU1FTlTjgpLjgr/jgrDku5jjgZFcbiAgICBpZiAoZWxlbWVudCAmJiAhc2FtZVR5cGUpIHtcbiAgICAgIG5ld0ZpYmVyID0ge1xuICAgICAgICB0eXBlOiBlbGVtZW50LnR5cGUsXG4gICAgICAgIHByb3BzOiBlbGVtZW50LnByb3BzLFxuICAgICAgICBkb206IG51bGwsXG4gICAgICAgIHBhcmVudDogd2lwRmliZXIsXG4gICAgICAgIGFsdGVybmF0ZTogbnVsbCxcbiAgICAgICAgZWZmZWN0VGFnOiBcIlBMQUNFTUVOVFwiLFxuICAgICAgfTtcbiAgICB9XG4gICAgLy8g44OO44O844OJ44KS5YmK6Zmk44GZ44KL5b+F6KaB44GM44GC44KL5aC05ZCI44Gv44CB5paw44GX44GE44OV44Kh44Kk44OQ44O844GM44Gq44GE44Gf44KB44CB5Y+k44GE44OV44Kh44Kk44OQ44O844Gr44Ko44OV44Kn44Kv44OI44K/44Kw44KS6L+95YqgXG4gICAgaWYgKG9sZEZpYmVyICYmICFzYW1lVHlwZSkge1xuICAgICAgb2xkRmliZXIuZWZmZWN0VGFnID0gXCJERUxFVElPTlwiO1xuICAgICAgZGVsZXRpb25zLnB1c2gob2xkRmliZXIpO1xuICAgIH1cblxuICAgIGlmIChvbGRGaWJlcikge1xuICAgICAgb2xkRmliZXIgPSBvbGRGaWJlci5zaWJsaW5nO1xuICAgIH1cblxuICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgd2lwRmliZXIuY2hpbGQgPSBuZXdGaWJlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJldlNpYmxpbmcuc2libGluZyA9IG5ld0ZpYmVyO1xuICAgIH1cblxuICAgIHByZXZTaWJsaW5nID0gbmV3RmliZXI7XG4gICAgaW5kZXgrKztcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVEb20oZmliZXIpIHtcbiAgLy8gZWxlbWVudCB0eXBlIOOBq+W/nOOBmOOBpuODjuODvOODieOCkuS9nOaIkFxuICBjb25zdCBkb20gPVxuICAgIGZpYmVyLnR5cGUgPT09IFwiVEVYVF9FTEVNRU5UXCJcbiAgICAgID8gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJcIilcbiAgICAgIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudChmaWJlci50eXBlKTtcblxuICAvLyBjaGlsZHJlbiDjgpLpmaTjgY8gcHJvcGVydHkg44Gu5Ymy44KK5b2T44GmXG4gIGNvbnN0IGlzUHJvcGVydHkgPSAoa2V5KSA9PiBrZXkgIT09IFwiY2hpbGRyZW5cIjtcbiAgT2JqZWN0LmtleXMoZmliZXIucHJvcHMpXG4gICAgLmZpbHRlcihpc1Byb3BlcnR5KVxuICAgIC5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgICBkb21bbmFtZV0gPSBmaWJlci5wcm9wc1tuYW1lXTtcbiAgICB9KTtcblxuICByZXR1cm4gZG9tO1xufVxuXG5jb25zdCBEaWRhY3QgPSB7XG4gIGNyZWF0ZUVsZW1lbnQsXG4gIHJlbmRlcixcbn07XG5cbi8qKiBAanN4IERpZGFjdC5jcmVhdGVFbGVtZW50ICovXG5mdW5jdGlvbiBBcHAocHJvcHMpIHtcbiAgcmV0dXJuIDxoMT5IaSB7cHJvcHMubmFtZX08L2gxPjtcbn1cblxuY29uc3QgZWxlbWVudCA9IDxBcHAgbmFtZT1cImZvb1wiIC8+O1xuY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyb290XCIpO1xuRGlkYWN0LnJlbmRlcihlbGVtZW50LCBjb250YWluZXIpO1xuIl0sIm5hbWVzIjpbImNyZWF0ZUVsZW1lbnQiLCJ0eXBlIiwicHJvcHMiLCJjaGlsZHJlbiIsIm1hcCIsImNoaWxkIiwiY3JlYXRlVGV4dEVsZW1lbnQiLCJ0ZXh0Iiwibm9kZVZhbHVlIiwibmV4dFVuaXRPZldvcmsiLCJjdXJyZW50Um9vdCIsIndpcFJvb3QiLCJkZWxldGlvbnMiLCJjb21taXRSb290IiwiY29tbWl0V29yayIsInJlbmRlciIsImVsZW1lbnQiLCJjb250YWluZXIiLCJkb20iLCJhbHRlcm5hdGUiLCJmaWJlciIsImRvbVBhcmVudEZpYmVyIiwicGFyZW50IiwiZG9tUGFyZW50IiwiZWZmZWN0VGFnIiwiYXBwZW5kQ2hpbGQiLCJ1cGRhdGVEb20iLCJjb21taXREZWxldGlvbiIsInNpYmxpbmciLCJpc05ldyIsInByZXYiLCJuZXh0Iiwia2V5IiwiaXNHb25lIiwiaXNFdmVudCIsInN0YXJ0c1dpdGgiLCJpc1Byb3BlcnR5IiwicHJldlByb3BzIiwibmV4dFByb3BzIiwiT2JqZWN0Iiwia2V5cyIsImZpbHRlciIsImZvckVhY2giLCJuYW1lIiwiZXZlbnRUeXBlIiwidG9Mb3dlckNhc2UiLCJzdWJzdHJpbmciLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUNoaWxkIiwid29ya0xvb3AiLCJkZWFkbGluZSIsInNob3VsZFlpZWxkIiwicGVyZm9ybVVuaXRPZldvcmsiLCJ0aW1lUmVtYWluaW5nIiwicmVxdWVzdElkbGVDYWxsYmFjayIsImlzRnVuY3Rpb25Db21wb25lbnQiLCJGdW5jdGlvbiIsInVwZGF0ZUZ1bmN0aW9uQ29tcG9uZW50IiwidXBkYXRlSG9zdENvbXBvbmVudCIsImVsZW1lbnRzIiwicmVjb25jaWxlQ2hpbGRyZW4iLCJuZXh0RmliZXIiLCJjcmVhdGVEb20iLCJ3aXBGaWJlciIsImluZGV4Iiwib2xkRmliZXIiLCJwcmV2U2libGluZyIsImxlbmd0aCIsIm5ld0ZpYmVyIiwic2FtZVR5cGUiLCJwdXNoIiwiZG9jdW1lbnQiLCJjcmVhdGVUZXh0Tm9kZSIsIkRpZGFjdCIsIkFwcCIsImdldEVsZW1lbnRCeUlkIl0sInNvdXJjZVJvb3QiOiIifQ==